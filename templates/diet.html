{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2>My Latest Diet Plan</h2>
    {% if record and plan_data %}
    <div class="results-card fade-in">
        <h3>Plan for {{ record.name }}</h3>
        <p>This plan was generated based on a weight of <strong>{{ record.weight }} kg</strong>, a height of <strong>{{ record.height }} cm</strong>, and a BMI of <strong>{{ record.bmi }}</strong>.</p>
        <p>Your goal was: <strong>{{ record.goal|title }}</strong>.</p>
        <div class="highlight">Daily calorie target: <strong>{{ plan_data.calories }} kcal</strong>.</div>
        <h4>Estimated Daily Nutrition:</h4>
        <div class="nutrition-grid">
            <div class="nutrition-item"><span><i class="bi bi-heart-pulse-fill"></i> Protein</span><strong>{{ plan_data.totals.protein }}g</strong></div>
            <div class="nutrition-item"><span><i class="bi bi-fire"></i> Carbs</span><strong>{{ plan_data.totals.carbs }}g</strong></div>
            <div class="nutrition-item"><span><i class="bi bi-droplet-fill"></i> Fat</span><strong>{{ plan_data.totals.fat }}g</strong></div>
            <div class="nutrition-item"><span><i class="bi bi-cup-straw"></i> Sugar</span><strong>{{ plan_data.totals.sugar }}g</strong></div>
        </div>
        <h4 class="meals-title">Suggested Meal Schedule</h4>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Meal</th>
                    <th>Suggested Foods</th>
                </tr>
            </thead>
            <tbody>
                {% for meal in plan_data.meals %}
                <tr>
                    <td><strong>{{ meal.time }}</strong></td>
                    <td>{{ meal.name }}</td>
                    <td>
                         <ul class="meal-food-list">
                            {% for item in meal.foods %}
                            <li class="food-item">
                                <img src="{{ url_for('static', filename='images/' + item.image) }}" alt="{{ item.name }}" class="food-image">
                                <div class="food-info">
                                    <strong>{{ item.name|title }}</strong>
                                    <div class="food-details">
                                        <span>{{ item.calories|round(0) }} kcal</span> | <span>P: {{ item.protein }}g</span> | <span>F: {{ item.fat }}g</span>
                                    </div>
                                </div>
                            </li>
                            {% else %}<li>No items suggested.</li>{% endfor %}
                        </ul>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
     <div class="button-container" style="margin-top: 20px;">
        <a href="{{ url_for('diet.download_plan') }}" class="btn" style="background-image: linear-gradient(45deg, #3498DB, #2980B9); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4);"><i class="bi bi-download"></i> Download as PDF</a>
    </div>
    {% else %}
    <div class="alert">
        <p>No diet plan has been generated yet. Please use the BMI Calculator to create your first plan.</p>
        <a href="{{ url_for('bmi_bp.bmi_page') }}" class="btn">Go to Calculator</a>
    </div>
    {% endif %}
</div>
{% endblock %}